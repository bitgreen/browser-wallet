<!--
    An example: 
    - to transfer 1 Bitgreen
    - make a Signature and receive an authentication token

    ## Attention: the example need to be used from https, it does not work opened locally because of the check on target origin (window.location.href)
    ## to use locally you should replace the parameter window.location.href with "*".
-->
<html>
  <h1>Examples for Browser Wallet</h1>
  <button id="transferbutton">Transfer 1 Bitgreen</button>
  <button id="signinbutton">Sign In</button>

  <script>
    // remove previous signin session
    sessionStorage.removeItem("bitgreenwallet");

    let button = document.getElementById("transferbutton");
    button.addEventListener("click", () =>{
      // Set the same url as origin target to avoid leaking of the message using "*"
      // send the message to be received from the injected contentscript.js of the extension
       window.postMessage({ type: "BROWSER-WALLET", command: "transfer",recipient: "5HVfcSujPyT2hisdLDQhHXzCDx2e37UBM3h9fW65qkHx4FbN",amount: 1 }, window.location.href);
    }, false);
    let button2 = document.getElementById("signinbutton");
    button2.addEventListener("click", () =>{
      // Set the same url as origin target to avoid leaking of the message using "*"
      // send the message to be received from the injected contentscript.js of the extension
       window.postMessage({ type: "BROWSER-WALLET", command: "signin"}, window.location.href);
       // calle the function wait for signature with a timeout of 60 seconds
       BWwaitforSignature();
    }, false);

    // function to wait for signed token
    let BWtimeout=0;   // use for exit after the timeout of 60 seconds.
    function BWwaitforSignature() {
        // exit for timeout of 1 minute
        if(BWtimeout>=60){
            BWMessage="";
            BWtimeout=0;
            return;            
        }
        if(sessionStorage.getItem("bitgreenwallet")===null) {
            setTimeout(BWwaitforSignature, 1000); //wait 1 second and check again
            BWtimeout=timeout+1;
            return;
        }else {
            // for example, redirect to dashboard 
            alert("Signup complete, we may redirect to a dashboard now...")
            BWtimeout=0;
        }
    }
  </script>
</html>
