<!--
    An example: 
    - to transfer 1 Bitgreen
    - make a Signature and receive an authentication token

    ## Attention: the example need to be used from https, it does not work opened locally because of the check on target origin (window.location.href)
    ## to use locally you should replace the parameter window.location.href with "*".
-->
<html>
  <h1>Examples for Browser Wallet</h1>
  <hr>
  <h3>Here the basic examples to call the functions of the Browser Wallet.</h3>
  <hr>
  <button id="transferbutton">Transfer 1 Bitgreen</button>
  <button id="signinbutton">Sign In</button>
  <button id="kyc">Bond - Submit KYC</button>
  <button id="portfolio">Porfolio</button>
  <button id="project">Create Project</button>
  <!-- include the BitgreenWallet library-->
  <script type="text/javascript" src="BrowserWallet.js"></script>
  <script>
    // remove previous signin session
    sessionStorage.removeItem("BrowserWalletToken");
    // create class object for BitGreen Wallet
    let BW= new BitgreenWallet();
    let button = document.getElementById("transferbutton");
    button.addEventListener("click", () =>{
      // send 1 BBB to a recipient
      BW.transfer("5HVfcSujPyT2hisdLDQhHXzCDx2e37UBM3h9fW65qkHx4FbN",1,transferCallback);
    }, false);
    let button2 = document.getElementById("signinbutton");
    button2.addEventListener("click", () =>{
        // authenticate signing a random message
        BW.authenticate(callbackauthentication);
    }, false);
    let button3 = document.getElementById("kyc");
    button3.addEventListener("click", () =>{
        // send extrinsic
        //BW.tx("bonds","createChangeKyc",'{"accountid":"5GebatEBGmXsQoVyQ2mjsodKWs2eUM3Sm8o2LMSU6uFc42FD","info":"{\\"name\\":\\"Smith and Wesson Inc\\",\\"address\\":\\"103, Paris Boulevard\\",\\"city\\":\\"London\\",\\"zip\\":\\"00100\\",\\"state\\":\\"England\\",\\"country\\":\\"Great Britain\\",\\"phone\\":\\"+441232322332\\",\\"website\\":\\"https://www.smith.co.uk\\",\\"ipfsdocs\\":[{\\"description\\":\\"Balance Sheet 2020\\",\\"ipfsaddress\\":\\"42ff96731ce1f53aa014c55662a3964b61422c2c9c3f38c11b2cf3ee45440c7c\\"},{\\"description\\":\\"Revenue Report 2021\\",\\"ipfsaddress\\":\\"b26707691ce34a738fa5dab526e800be831bcc63a199a7d83414f5d6b0a8836c\\"}]}"}',false);
        BW.tx("bonds","createChangeKyc",'["5GebatEBGmXsQoVyQ2mjsodKWs2eUM3Sm8o2LMSU6uFc42FD","{\\"name\\":\\"Smith and Wesson Inc\\",\\"address\\":\\"103, Paris Boulevard\\",\\"city\\":\\"London\\",\\"zip\\":\\"00100\\",\\"state\\":\\"England\\",\\"country\\":\\"Great Britain\\",\\"phone\\":\\"+441232322332\\",\\"website\\":\\"https://www.smith.co.uk\\",\\"ipfsdocs\\":[{\\"description\\":\\"Balance Sheet 2020\\",\\"ipfsaddress\\":\\"42ff96731ce1f53aa014c55662a3964b61422c2c9c3f38c11b2cf3ee45440c7c\\"},{\\"description\\":\\"Revenue Report 2021\\",\\"ipfsaddress\\":\\"b26707691ce34a738fa5dab526e800be831bcc63a199a7d83414f5d6b0a8836c\\"}]}"]',txCallback);
    },false);
    let button4 = document.getElementById("portfolio");
    button4.addEventListener("click", () =>{
      // send 1 BBB to a recipient
      BW.portfolio();
    }, false);
    let button5 = document.getElementById("project");
    button5.addEventListener("click", () =>{
        // send extrinsic
        BW.tx("vcu","create",'["2222",{"name":"Smith and Wesson Inc","description":"Test Description","images":["image 1","image 2"]}]', false);
    }, false);

    // function called after the signing
    function callbackauthentication(){
        // the token is stored in the session variable.
        console.log("Authentication token: ",sessionStorage.getItem("BrowserWalletToken"));
    }
    function transferCallback() {
        console.log("Transfer Result: ",sessionStorage.getItem("BrowserWalletTransfer"));
    }
    window.addEventListener('EXTRINSIC', function(e) {
      console.log(e.detail)

      // alert(`Extrinsic with ID ${e.detail.id} status: ${e.detail.status}`)
    });
  </script>
  
</html>
